# نظام IQR Control - التوثيق الكامل

## 📌 الوضع الحالي

### ✅ النسخة المحلية على Replit
- **الحالة**: تعمل بشكل صحيح 100%
- **قاعدة البيانات**: Neon PostgreSQL - محدثة بالكامل
- **جميع الميزات**: تعمل بدون مشاكل

### ⚠️ النسخة المنشورة على Render
- **المشكلة**: قاعدة البيانات تحتاج تحديث
- **السبب**: العمودان `is_down_payment` و `total_amount` غير موجودين في جدول `income_entries`
- **الحل**: موجود في ملف `DEPLOYMENT_GUIDE.md`

---

## 🔍 ما تم إصلاحه

### 1. تحديث ملف `server/db.ts`
أضفت الأعمدة المفقودة في جدول `income_entries`:
- ✅ `is_down_payment` - لتحديد إذا كان المبلغ عربون
- ✅ `total_amount` - المبلغ الكامل عند اختيار العربون

### 2. إضافة جدول `receivables`
أضفت جدول المستحقات الكامل لتتبع العرابين والمبالغ المتبقية

### 3. تحديث قاعدة البيانات
شغلت `npm run db:push --force` لمزامنة قاعدة البيانات مع السكيما

---

## 📊 هيكل قاعدة البيانات

### الجداول الموجودة:
1. **users** - المستخدمين
2. **customers** - العملاء
3. **income_entries** - الإدخالات (الإيرادات)
4. **expense_entries** - الإخراجات (المصروفات)
5. **employees** - الموظفين
6. **receivables** - المستحقات
7. **activities** - سجل الأنشطة
8. **session** - الجلسات

### معلومات تسجيل الدخول:
- **اسم المستخدم**: `admin`
- **كلمة المرور**: `admin123`

---

## 🚀 للعمل على Render

### الخيار 1: تحديث يدوي (موصى به)
اتبع التعليمات في ملف `DEPLOYMENT_GUIDE.md`

### الخيار 2: إعادة النشر من Replit
1. تأكد من أن جميع التغييرات محفوظة في Git
2. ادفع التحديثات إلى GitHub/GitLab
3. في Render، اضغط على "Manual Deploy"
4. بعد النشر، شغل `npm run db:push --force` من Render Shell

---

## 🧪 اختبار التطبيق المحلي

### على Replit:
1. افتح التطبيق من علامة التبويب "Webview"
2. سجل الدخول بـ: admin / admin123
3. جرب:
   - إضافة عميل جديد
   - إضافة إدخال عادي
   - إضافة إدخال بعربون
   - عرض المستحقات

كل شيء يجب أن يعمل بدون مشاكل!

---

## 📁 الملفات المهمة

### ملفات قاعدة البيانات:
- `shared/schema.ts` - تعريف جداول قاعدة البيانات
- `server/db.ts` - إعداد الاتصال وإنشاء الجداول
- `server/storage.ts` - عمليات قاعدة البيانات (CRUD)
- `drizzle.config.ts` - إعدادات Drizzle ORM

### ملفات الخادم:
- `server/index.ts` - نقطة الدخول الرئيسية
- `server/routes.ts` - مسارات API
- `server/auth.ts` - نظام المصادقة

### ملفات العميل:
- `client/src/App.tsx` - التطبيق الرئيسي
- `client/src/pages/` - صفحات التطبيق

---

## 🔧 الأوامر المفيدة

### التطوير:
```bash
npm run dev          # تشغيل التطبيق في وضع التطوير
npm run build        # بناء التطبيق للإنتاج
npm run start        # تشغيل التطبيق في وضع الإنتاج
```

### قاعدة البيانات:
```bash
npm run db:push           # مزامنة السكيما مع قاعدة البيانات
npm run db:push -- --force # مزامنة إجبارية (للتحديثات الكبيرة)
```

---

## 📈 الميزات المتوفرة

### ✅ إدارة العملاء
- إضافة عملاء جدد
- تعديل بيانات العملاء
- تجديد الاشتراكات
- تتبع تواريخ الانتهاء

### ✅ الإدخالات (الإيرادات)
- تسجيل إدخالات الاشتراكات
- تسجيل إدخالات المطبوعات
- دعم نظام العرابين
- رفع إيصالات الدفع

### ✅ المستحقات
- تتبع العرابين
- حساب المبالغ المتبقية
- تسجيل عمليات التسديد
- عرض جميع المستحقات

### ✅ الإخراجات (المصروفات)
- تسجيل المصروفات
- تصنيف الأسباب
- التقارير المالية

### ✅ التقارير
- تقارير مالية شاملة
- تقارير العملاء
- تقارير الموظفين
- تقارير المطبوعات

### ✅ لوحة التحكم
- إحصائيات في الوقت الفعلي
- رسوم بيانية تفاعلية
- الأنشطة الأخيرة
- تنبيهات الاشتراكات المنتهية

---

## 🎯 الخطوات التالية

1. **للاستمرار في التطوير على Replit**:
   - كل شيء جاهز ويعمل
   - يمكنك البدء في إضافة ميزات جديدة

2. **للنشر على Render**:
   - اتبع التعليمات في `DEPLOYMENT_GUIDE.md`
   - حدّث قاعدة البيانات
   - أعد النشر

3. **للنشر على خدمة أخرى**:
   - تأكد من إضافة متغيرات البيئة الصحيحة
   - شغّل `npm run db:push -- --force` بعد النشر
   - تأكد من الاتصال بقاعدة بيانات Neon

---

## 💡 نصائح مهمة

### أمان قاعدة البيانات:
- لا تشارك رابط `DATABASE_URL` مع أحد
- غيّر كلمة مرور المدير بعد أول تسجيل دخول
- استخدم `SESSION_SECRET` قوي في الإنتاج

### النسخ الاحتياطي:
- Neon يقوم بنسخ احتياطي تلقائي
- يمكنك أيضاً تصدير البيانات يدوياً من Neon Dashboard

### الأداء:
- استخدم Connection Pooling في الإنتاج
- راقب استخدام قاعدة البيانات في Neon Dashboard

---

## 📞 المساعدة

إذا واجهت أي مشكلة:
1. تحقق من ملف `DEPLOYMENT_GUIDE.md`
2. راجع السجلات في Render أو Replit
3. تأكد من اتصال قاعدة البيانات

---

## ✨ الخلاصة

**النسخة المحلية على Replit**:
- ✅ تعمل بشكل كامل
- ✅ قاعدة البيانات محدثة
- ✅ جميع الميزات متوفرة

**للعمل على Render**:
- ⚠️ تحتاج تحديث قاعدة البيانات
- 📖 اتبع `DEPLOYMENT_GUIDE.md`
- 🚀 ستعمل بعد التحديث

**كل شيء جاهز للاستخدام!** 🎉
